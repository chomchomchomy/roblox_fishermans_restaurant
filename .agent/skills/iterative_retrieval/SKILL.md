---
name: iterative-retrieval
description: 複雑なタスクにおいて、必要なコンテキストを段階的に深掘りして収集するスキル。
---

# Iterative Retrieval Skill

タスクに必要な「正しいファイル」と「背景知識」を特定するために、最大3サイクルの反復検索を行います。

## 使用タイミング
- 修正箇所が不明瞭なバグの調査時
- 新機能の実装で、関連する既存コードを探す時
- 大規模なリファクタリングの前後

## 実行フェーズ

### フェーズ 1: DISPATCH (広範な検索)
まずは広い範囲で候補を探します。
- `grep_search` や `find_by_name` を使い、キーワードやファイルパターンで候補を抽出します。

### フェーズ 2: EVALUATE (評価)
取得した内容の関連度を 0.0 〜 1.0 でスコアリングします。
- **High (0.8-1.0)**: 直接的な実装箇所。
- **Medium (0.5-0.7)**: 関連する型定義やユーティリティ。
- **Low (0.2-0.4)**: 名前は似ているが無関係。

### フェーズ 3: REFINE (絞り込みと再検索)
評価結果に基づき、以下のアクションを取ります。
- 関連度が高いファイルで見つかった「新しいキーワード」で再検索。
- 関連度が低かったパスを検索対象から除外。
- 足りない情報（例：「この関数を呼んでいる箇所はどこか？」）を特定する。

### フェーズ 4: LOOP
上記を繰り返し、スコア 0.7 以上の重要なファイルが揃った時点で分析を開始します。

## プロンプトへの組み込み
コンテキスト収集中、私は心の中で以下のステップを踏みます：
1. 「まずはキーワード 'X' で広く探そう」
2. 「見つかった A.ts は重要だが、B.ts は関係ないな。次は 'Y' という概念が含まれるファイルを狙おう」
3. 「十分な情報が揃った。これで正確に実装できる」
