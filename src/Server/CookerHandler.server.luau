-- CookerHandler.server.luau
-- ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³å†…ã§ã®èª¿ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ10ç§’å¾…æ©Ÿå¾Œã®é«˜å˜ä¾¡å¤‰æ›ï¼‰

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Shared = ReplicatedStorage:WaitForChild("Shared")
local FishData = require(Shared:WaitForChild("FishData"))

local function setupRestaurant()
    local stand = workspace:WaitForChild("FoodStand", 10)
    if not stand then return end

    local counter = stand:FindFirstChild("SellCounter")
    if not counter then return end

    -- èª¿ç†å ´ï¼ˆã‚°ãƒªãƒ«ï¼‰ã‚’è¨­ç½®
    local grill = Instance.new("Part")
    grill.Name = "CookingStation"
    grill.Size = Vector3.new(4, 0.5, 4)
    grill.Position = counter.Position + Vector3.new(-4, 2.3, 0)
    grill.Color = Color3.fromRGB(30, 30, 30)
    grill.Material = Enum.Material.Metal
    grill.Anchored = true
    grill.Parent = stand

    -- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼ˆèª¿ç†ä¸­ã®ç«ï¼‰
    local fire = Instance.new("ParticleEmitter")
    fire.Enabled = false
    fire.Texture = "rbxassetid://241539266"
    fire.Rate = 50
    fire.Lifetime = NumberRange.new(0.5, 1)
    fire.Parent = grill

    -- èª¿ç†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
    local prompt = Instance.new("ProximityPrompt")
    prompt.ActionText = "é­šã‚’ã˜ã£ãã‚Šç„¼ã (10ç§’)"
    prompt.ObjectText = "æœ€æ–°é‹­ã‚°ãƒªãƒ«"
    prompt.HoldDuration = 1.0 
    prompt.Parent = grill

    prompt.Triggered:Connect(function(player)
        if player:GetAttribute("IsCooking") then
            warn("ã™ã§ã«èª¿ç†ä¸­ã§ã™ï¼")
            return
        end

        local backpack = player:FindFirstChild("Backpack")
        local char = player.Character
        local items = {}
        
        -- æ‰‹ã«æŒã£ã¦ã„ã‚‹é­šã‚’å„ªå…ˆçš„ã«èª¿ç†
        if char then
            for _, i in pairs(char:GetChildren()) do
                if i:IsA("Tool") and i.Name ~= "FishingRod" and not i.Name:find("ç„¼ãé­š") then
                    table.insert(items, i)
                end
            end
        end
        
        -- ãƒãƒƒã‚¯ãƒ‘ãƒƒã‚¯ã®é­šã‚‚å…¥ã‚Œã‚‹
        if #items == 0 and backpack then
            for _, i in pairs(backpack:GetChildren()) do
                if i:IsA("Tool") and i.Name ~= "FishingRod" and not i.Name:find("ç„¼ãé­š") then
                    table.insert(items, i)
                end
            end
        end

        if #items > 0 then
            player:SetAttribute("IsCooking", true)
            print("ğŸ³ [" .. player.Name .. "] ãŒã˜ã£ãã‚Šèª¿ç†ã‚’é–‹å§‹ã—ã¾ã—ãŸ (10ç§’å¾…ã¡)")
            fire.Enabled = true
            
            -- èª¿ç†ã™ã‚‹é­šã®ä¾¡å€¤ã‚’è¨˜æ†¶
            local cookedFishes = {}
            for _, fish in pairs(items) do
                local originalValue = fish:GetAttribute("Value") or 10
                table.insert(cookedFishes, {name = fish.Name, value = math.floor(originalValue * 2.5)})
                fish:Destroy()
            end

            -- 10ç§’å¾…æ©Ÿï¼ˆã“ã“ãŒä¿®è¡Œï¼ï¼‰
            task.wait(10)

            print("ğŸ’° èª¿ç†å®Œäº†ï¼")
            fire.Enabled = false
            
            -- ã€Œç„¼ãé­šã€ã¨ã—ã¦æˆ»ã™
            for _, data in pairs(cookedFishes) do
                local grilled = Instance.new("Tool")
                grilled.Name = "ğŸ”¥ç„¼ãé­š (" .. data.name .. ")"
                grilled:SetAttribute("Value", data.value)
                grilled.ToolTip = "å£²å€¤: " .. data.value .. "å†† (èª¿ç†æ¸ˆã¿)"
                grilled.RequiresHandle = false
                grilled.Parent = player:WaitForChild("Backpack")
            end
            
            player:SetAttribute("IsCooking", false)
        else
            warn("ç„¼ããŸã‚ã®ç”Ÿé­šã‚’æŒã£ã¦ã„ã¾ã›ã‚“ï¼")
        end
    end)
end

task.spawn(setupRestaurant)
