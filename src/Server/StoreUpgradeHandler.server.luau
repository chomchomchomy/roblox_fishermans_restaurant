-- StoreUpgradeHandler.server.luau
-- åº—èˆ—é€²åŒ–ï¼ˆStoreStageï¼‰ã®ç®¡ç†ã¨ã‚¢ãƒ³ãƒ­ãƒƒã‚¯å‡¦ç†

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

-- ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ç”¨ã®ãƒ‘ãƒ¼ãƒ„ï¼ˆçœ‹æ¿ã‚„ãƒœã‚¿ãƒ³ï¼‰ã‚’ç”Ÿæˆã™ã‚‹
local function setupUpgradeSign()
    local stand = workspace:WaitForChild("FoodStand", 10)
    if not stand then return end

    -- çœ‹æ¿ã®åœŸå°
    local sign = Instance.new("Part")
    sign.Name = "UpgradeSign"
    sign.Size = Vector3.new(3, 1, 0.5)
    sign.Position = stand.PrimaryPart.Position + Vector3.new(8, 3, -5) -- å±‹å°ã®æ¨ªã‚‰ã¸ã‚“
    sign.Color = Color3.fromRGB(150, 100, 50)
    sign.Material = Enum.Material.Wood
    sign.Anchored = true
    sign.Parent = workspace

    local gui = Instance.new("SurfaceGui")
    gui.Parent = sign
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = "åº—èˆ—æ‹¡å¼µï¼š1000å††\n(èª¿ç†å¸«ã‚’é›‡ã†)"
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.TextScaled = true
    textLabel.Font = Enum.Font.LuckiestGuy
    textLabel.Parent = gui

    -- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
    local prompt = Instance.new("ProximityPrompt")
    prompt.ActionText = "åº—èˆ—ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼"
    prompt.ObjectText = "å¤¢ã®ãƒã‚¤ã‚·ãƒ§ãƒƒãƒ—"
    prompt.HoldDuration = 2.0
    prompt.Parent = sign

    prompt.Triggered:Connect(function(player)
        local stage = player:GetAttribute("StoreStage") or 0
        local leaderstats = player:FindFirstChild("leaderstats")
        local money = leaderstats and leaderstats:FindFirstChild("Money")

        if not money then return end

        if stage == 0 then
            local cost = 1000
            if money.Value >= cost then
                money.Value -= cost
                player:SetAttribute("StoreStage", 1)
                
                -- é€šå ±ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¨ã‹
                print("ğŸŠ [" .. player.Name .. "] ãŒãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼")
                textLabel.Text = "åº—èˆ—æ‹¡å¼µï¼šå®Œäº†ï¼\n(ã‚·ã‚§ãƒ•ãŒåˆ°ç€ã—ã¾ã—ãŸ)"
                prompt.Enabled = false
            else
                print("âŒ ãŠé‡‘ãŒè¶³ã‚Šã¾ã›ã‚“ï¼ (å¿…è¦: " .. cost .. "å††)")
            end
        else
            print("ã™ã§ã«è¿½åŠ ã‚¹ãƒ†ãƒ¼ã‚¸ã«åˆ°é”ã—ã¦ã„ã¾ã™ã€‚")
        end
    end)
end

task.spawn(setupUpgradeSign)
