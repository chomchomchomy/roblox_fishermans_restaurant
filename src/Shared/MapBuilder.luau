-- MapBuilder.luau
-- ãƒãƒƒãƒ—ã®è¨­è¨ˆå›³ã‚’ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦ä¿å­˜ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
local MapBuilder = {}

local terrain = workspace.Terrain

-- 1. ä¸–ç•Œã®åœŸå°ï¼ˆæµ·ã¨å³¶ï¼‰
function MapBuilder.buildBase()
    -- åœ°å½¢ã‚’ä¸€æ—¦ãƒªã‚»ãƒƒãƒˆ
    terrain:Clear()
    
    -- å·¨å¤§ãªæ·±æµ· (æ·±ã•180ã‚¹ã‚¿ãƒƒãƒ‰)
    -- ä¸­å¿ƒã‚’å°‘ã—ä¸‹ã«ä¸‹ã’ã¦ã€è¡¨é¢ãŒæµ·é¢(Y=0)ã®å°‘ã—ä¸‹ã«æ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹
    terrain:FillBlock(CFrame.new(0, -95, 0), Vector3.new(4000, 180, 4000), Enum.Material.Water)
    
    -- å¿«é©ãªç ‚æµœã®å³¶ (åŠå¾„150ã‚¹ã‚¿ãƒƒãƒ‰ã€åšã•10ã‚¹ã‚¿ãƒƒãƒ‰ã®å††ç›¤)
    -- Cylinderã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‚ç›´æ–¹å‘(Yè»¸)ã‚’å‘ã„ã¦ã„ã‚‹ã®ã§ã€å›è»¢ã¯ä¸è¦ï¼
    -- Position = (0, -4, 0) ã§ã€ä¸Šç«¯ãŒ Y=1 ã«ãªã‚‹ã‚ˆã†ã«è¨­å®š
    local islandCFrame = CFrame.new(0, -4, 0)
    terrain:FillCylinder(islandCFrame, 8, 150, Enum.Material.Sand)
    
    -- ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Œã°æ¶ˆã™
    if workspace:FindFirstChild("Baseplate") then
        workspace.Baseplate:Destroy()
    end
    
    print("ğŸï¸ Base Island and Ocean built (Flat version)!")
end

-- 2. æ¡Ÿæ©‹ï¼ˆ Pierï¼‰ã®å»ºç¯‰
function MapBuilder.buildPier()
    -- æ—¢å­˜ã®æ¡Ÿæ©‹ãŒã‚ã‚Œã°å‰Šé™¤
    if workspace:FindFirstChild("FishingPier") then
        workspace.FishingPier:Destroy()
    end

    local folder = Instance.new("Folder", workspace)
    folder.Name = "FishingPier"
    
    -- å³¶ã®ä¸­å¿ƒ(0,0,0)ã‹ã‚‰ã€æµ·(Zæ–¹å‘)ã«å‘ã‹ã£ã¦ä¼¸ã°ã™
    -- åŠå¾„150ã®å³¶ãªã®ã§ã€130ã‚ãŸã‚Šã‹ã‚‰é–‹å§‹ã—ã¦æµ·ã¸çªãå‡ºã™
    local startZ = 130 
    local length = 100
    local height = 2.5 -- ç ‚æµœ(Y=1)ã‹ã‚‰å°‘ã—æµ®ã‹ã›ãŸé«˜ã•
    local width = 14
    
    for i = 0, length, 4 do
        local plank = Instance.new("Part")
        plank.Name = "Plank"
        plank.Size = Vector3.new(width, 1, 3.8)
        plank.CFrame = CFrame.new(0, height, startZ + i)
        plank.Color = Color3.fromRGB(110, 85, 60)
        plank.Material = Enum.Material.WoodPlanks
        plank.Transparency = 0 -- å¿µã®ãŸã‚
        plank.Anchored = true
        plank.Parent = folder
        
        -- æ”¯æŸ±
        if i % 12 == 0 then
            for side = -1, 1, 2 do
                local post = Instance.new("Part")
                post.Name = "Post"
                post.Size = Vector3.new(2, 40, 2)
                post.Position = plank.Position + Vector3.new((width/2 - 1) * side, -20, 0)
                post.Color = Color3.fromRGB(70, 55, 45)
                post.Material = Enum.Material.Wood
                post.Anchored = true
                post.Parent = folder
            end
        end
    end
    print("ğŸŒŠ Pier extended into the deep ocean!")
end

-- 3. æµ·è¾ºã®å±‹å°ï¼ˆFood Standï¼‰ã®å»ºç¯‰
function MapBuilder.buildFoodStand()
    if workspace:FindFirstChild("FoodStand") then
        workspace.FoodStand:Destroy()
    end

    local folder = Instance.new("Folder", workspace)
    folder.Name = "FoodStand"
    
    -- æµ·ã‚’èƒŒã«ã—ãŸï¼ˆå³¶ã‚’å‘ã„ãŸï¼‰ã¨ãã«ã€Œå·¦å¥¥ã€ã¸ç§»å‹•
    -- æ¡Ÿæ©‹ãŒ X=0 ãªã®ã§ X=40, å³¶ã®å†…å´ãªã®ã§ Z=90 
    local basePos = Vector3.new(40, 1.5, 90) 
    
    -- 1. åºŠ
    local floor = Instance.new("Part")
    floor.Name = "Floor"
    floor.Size = Vector3.new(16, 1.2, 22)
    floor.Position = basePos
    floor.Color = Color3.fromRGB(110, 90, 70)
    floor.Material = Enum.Material.WoodPlanks
    floor.Anchored, floor.Parent = true, folder

    -- 2. ãƒ¡ã‚¤ãƒ³ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ (å³¶å´)
    local counter = Instance.new("Part")
    counter.Name = "Counter"
    counter.Size = Vector3.new(16, 4, 2)
    counter.Position = basePos + Vector3.new(0, 2, -8) -- å³¶ã®ä¸­å¿ƒå´
    counter.Color = Color3.fromRGB(80, 60, 40)
    counter.Material = Enum.Material.Wood
    counter.Anchored, counter.Parent = true, folder

    -- 3. ï¼ˆèª¿ç†å°ã¯å‰Šé™¤ã—ã¾ã—ãŸï¼šè¦–ç•Œã‚¹ãƒƒã‚­ãƒªï¼ï¼‰

    -- 4. æŸ±
    for x = -1, 1, 2 do
        for z = -1, 1, 2 do
            local pole = Instance.new("Part")
            pole.Size = Vector3.new(1.2, 10, 1.2)
            pole.Position = basePos + Vector3.new(7 * x, 5.5, 10 * z)
            pole.Color = Color3.fromRGB(80, 60, 40)
            pole.Material = Enum.Material.Wood
            pole.Anchored, pole.Parent = true, folder
        end
    end

    -- 5. å±‹æ ¹
    local roof = Instance.new("Part")
    roof.Name = "Roof"
    roof.Size = Vector3.new(20, 1, 26)
    roof.Position = basePos + Vector3.new(0, 10.5, 0)
    roof.Color = Color3.fromRGB(160, 40, 40)
    roof.Material = Enum.Material.Fabric
    roof.Anchored, roof.Parent = true, folder

    print("ğŸ± [World Builder] The Stand is now next to the Pier, facing the Island!")
end

-- ã™ã¹ã¦ã‚’ä¸€æ‹¬æ§‹ç¯‰
function MapBuilder.buildAll()
    MapBuilder.buildBase()
    MapBuilder.buildPier()
    MapBuilder.buildFoodStand() -- å±‹å°ã‚’è¿½åŠ ï¼
    
    -- ã‚¹ãƒ‘ãƒ¼ãƒ³åœ°ç‚¹ã‚’ä¸­å¤®ã«ï¼
    local spawn = workspace:FindFirstChild("SpawnLocation") or Instance.new("SpawnLocation", workspace)
    spawn.Position = Vector3.new(0, 5, 0)
    spawn.Size = Vector3.new(12, 1, 12)
    spawn.Anchored = true
    
    print("âœ… Full Map & Restaurant Synchronized from Code!")
end

return MapBuilder
