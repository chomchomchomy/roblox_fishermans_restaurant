-- BagUIHandler.client.luau
-- ã€ãƒ‡ãƒãƒƒã‚°ç‰¹åˆ¥ç‰ˆã€‘ä¸€è¡Œã”ã¨ã«ãƒ­ã‚°ã‚’å‡ºã—ã€UIã‚’å¼·åˆ¶è¡¨ç¤ºã™ã‚‹

print("ğŸš© [DEBUG 0] BagUIHandlerã®ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸï¼")

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

print("ğŸš© [DEBUG 1] ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å: " .. player.Name)

-- é€šä¿¡ãƒ‘ãƒ¼ãƒ„ã‚„ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
local sharedFolder = ReplicatedStorage:WaitForChild("Shared", 5)
if not sharedFolder then
    print("âŒ [ERROR] ReplicatedStorageã®ä¸­ã«Sharedãƒ•ã‚©ãƒ«ãƒ€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼")
end

local FishData = require(sharedFolder:WaitForChild("FishData"))
print("ğŸš© [DEBUG 2] ãŠé­šãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†: " .. #FishData .. "ç¨®é¡")

-- UIã®åœŸå°ä½œæˆ
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "DEBUG_BagUI"
screenGui.ResetOnSpawn = false
screenGui.DisplayOrder = 999 -- æœ€å‰é¢
screenGui.Parent = player:WaitForChild("PlayerGui")
print("ğŸš© [DEBUG 3] ScreenGuiã‚’PlayerGuiã«ä½œæˆã—ã¾ã—ãŸã€‚")

-- ã‚³ãƒ³ãƒ†ãƒŠï¼ˆæ ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã‚ã–ã¨è‰²ã‚’ã¤ã‘ã¾ã™ï¼‰
local container = Instance.new("Frame")
container.Name = "DEBUG_Container"
container.Size = UDim2.new(0, 300, 0, 100)
container.Position = UDim2.new(0.5, -150, 0.5, -50) -- â˜…ç”»é¢ã®ã©çœŸã‚“ä¸­ã«è¡¨ç¤ºï¼
container.BackgroundColor3 = Color3.fromRGB(255, 0, 0) -- â˜…çœŸã£èµ¤ã«ã—ã¦ç›®ç«‹ãŸã›ã‚‹ï¼
container.BackgroundTransparency = 0.5
container.ZIndex = 1000
container.Parent = screenGui
print("ğŸš© [DEBUG 4] ç”»é¢ä¸­å¤®ã«èµ¤ã„ãƒ‡ãƒãƒƒã‚°çª“ã‚’ä½œæˆã—ã¾ã—ãŸã€‚")

local capacityLabel = Instance.new("TextLabel")
capacityLabel.Size = UDim2.new(1, 0, 1, 0)
capacityLabel.BackgroundTransparency = 1
capacityLabel.Text = "ãƒãƒƒã‚°çŠ¶æ³ã‚’ç¢ºèªä¸­..."
capacityLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
capacityLabel.TextSize = 25
capacityLabel.Parent = container

-- ãƒãƒƒã‚°ç›£è¦–ã®é–‹å§‹
task.spawn(function()
    print("ğŸš© [DEBUG 5] Bagãƒ•ã‚©ãƒ«ãƒ€ã®å¾…æ©Ÿã‚’é–‹å§‹ã—ã¾ã™...")
    local bag = player:WaitForChild("Bag", 15) -- 15ç§’å¾…æ©Ÿ
    
    if not bag then
        print("âŒ [ERROR] 15ç§’å¾…ã£ã¦ã‚‚ãƒ•ã‚©ãƒ«ãƒ€ 'Bag' ãŒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼")
        capacityLabel.Text = "âŒ ãƒãƒƒã‚°ãƒ•ã‚©ãƒ«ãƒ€ãªã—ï¼"
        return
    end
    
    print("ğŸš© [DEBUG 6] Bagãƒ•ã‚©ãƒ«ãƒ€ã‚’ç™ºè¦‹ï¼")
    
    local function refresh()
        local count = #bag:GetChildren()
        print("ğŸš© [DEBUG 7] UIæ›´æ–°ã‚’å®Ÿè¡Œ: ç¾åœ¨ã®æ•° " .. count)
        capacityLabel.Text = "ğŸ‘œ ãƒãƒƒã‚°: " .. count .. " / 5"
    end
    
    bag.ChildAdded:Connect(refresh)
    bag.ChildRemoved:Connect(refresh)
    refresh()
    print("ğŸš© [DEBUG 8] ç›£è¦–ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒã™ã¹ã¦å®Œäº†ã—ã¾ã—ãŸï¼")
end)

print("âœ… [DEBUG END] ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æœ€å¾Œã¾ã§åˆ°é”ã—ã¾ã—ãŸã€‚")
